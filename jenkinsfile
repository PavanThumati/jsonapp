pipeline{
    agent any
    stages{
        stage('clone'){
            steps{
                git branch:'main', url:'https://github.com/PavanThumati/jsonapp.git'
            }
        }

        stage('building and pushing docker iamge'){
            steps{
                withDockerRegistry([CredentialsId:'dockerhub-creds',url:'http://index.docker/v1']){
                    docker build -t pavanthumati/node-app:latest .
                    docker push pavanthumati/node-app
                }
            }
        }

        stage('deploying the pods'){
            steps{
                withKubeConfig([CredentialsId:'kubeconfig-cred']){
                    kubectl apply -f deployment.yaml
                    kuubectl apply -f service.yaml
                }
            }
        }
    
    }
}
